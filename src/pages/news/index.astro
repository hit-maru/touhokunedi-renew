---
// src/pages/news/index.astro
import Layout from '../../layouts/Layout.astro';
import { getNews } from '../../lib/microcms';
import { format } from 'date-fns';

// MicroCMSから記事を取得（thumbnailを追加！）
const response = await getNews({ 
  fields: ["id", "title", "date", "category", "thumbnail"], 
  limit: 50,
  orders: '-date'
});
const { contents: news } = response;
---

<Layout title="お知らせ">
  
  <div class="bg-gray-100 pt-[90px] pb-8 border-b border-gray-200">
    <div class="container mx-auto px-6">
      <h1 class="text-4xl md:text-5xl font-mincho font-bold text-[#008B9B] mb-4">お知らせ</h1>
      <p class="text-gray-500 font-serif tracking-wider uppercase">NEWS</p>
    </div>
  </div>

  <section class="py-24 bg-white">
    <div class="container mx-auto px-6 max-w-4xl">
      
      {news.length === 0 ? (
        <p class="text-center font-sans text-gray-500">現在、お知らせはありません。</p>
      ) : (
        <ul class="border-t border-gray-200">
          {news.map((post) => (
            <li class="border-b border-gray-200">
              {/* パスから ${import.meta.env.BASE_URL} を削除！ */}
              <a href={`/news/${post.id}`} class="block py-6 group transition-colors hover:bg-gray-50 px-4">
                <div class="flex flex-col md:flex-row md:items-center gap-4">
                  
                  {/* サムネイル画像を表示するように戻しました */}
                  {post.thumbnail && (
                    <div class="w-full md:w-32 h-20 shrink-0 overflow-hidden rounded-sm bg-gray-100">
                      <img 
                        src={post.thumbnail.url} 
                        alt={post.title}
                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                      />
                    </div>
                  )}

                  <div class="flex items-center gap-4 w-48 shrink-0">
                    <time datetime={post.date} class="text-gray-400 font-serif text-sm tracking-tighter">
                      {format(new Date(post.date), 'yyyy.MM.dd')}
                    </time>
                    
                    {post.category && post.category.length > 0 && (
                      <span class="text-[10px] font-bold px-2 py-1 bg-gray-100 text-[#008B9B] rounded-sm uppercase tracking-widest font-mb101">
                        {post.category[0]}
                      </span>
                    )}
                  </div>
                  
                  <h3 class="text-gray-800 font-sans text-[15px] md:text-[16px] font-bold leading-relaxed group-hover:text-[#E64A19] transition-colors flex-grow">
                    {post.title}
                  </h3>

                  <div class="hidden md:block text-gray-300 group-hover:text-[#E64A19] transform group-hover:translate-x-1 transition-all">
                    →
                  </div>
                </div>
              </a>
            </li>
          ))}
        </ul>
      )}
    </div>
  </section>
</Layout>