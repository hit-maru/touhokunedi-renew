---
import Layout from '../layouts/Layout.astro';
import { getNews } from '../lib/microcms';
import { format } from 'date-fns';

/**
 * LinkedIn Embed
 * - 通常:代表投稿
 * - イベント前:直近イベント投稿に差し替え
 * - 更新頻度:年に数回
 */
const LINKEDIN_EMBED_URL =
  "https://www.linkedin.com/embed/feed/update/urn:li:share:7417757853383307264";

// 枠内スクロールを有効にするため、高さを1146から600へ変更
const LINKEDIN_IFRAME_HEIGHT = 600;

// 最新5件のお知らせを取得
const response = await getNews({ 
  fields: ["id", "title", "date", "category", "thumbnail"],
  limit: 5,
  orders: '-date'
});
const latestNews = response.contents;
---

<Layout title="Top">
  
  {/* --- ヒーローセクション:ここから --- */}
  <section id="hero-section" class="relative w-full h-screen min-h-screen overflow-hidden bg-gray-900">
    
    {/* 1. 背景ビデオ */}
    <div id="video-panel" class="absolute inset-0 w-full h-full z-10">
      <video autoplay muted loop playsinline poster="/images/main-visual.webp" class="w-full h-full object-cover object-center">
        <source src="/videos/Nedzi_web.mp4" type="video/mp4" />
      </video>
      <div class="absolute inset-0 bg-gradient-to-tr from-[#E64A19] to-gray-900 opacity-10 mix-blend-multiply z-20"></div>
      
      {/* 創業年 */}
      <div class="absolute bottom-10 left-1/2 -translate-x-1/2 md:left-auto md:right-10 md:translate-x-0 text-white text-center md:text-right z-30">
        <p class="text-sm tracking-widest mb-2 uppercase text-white">Established in</p>
        <p class="font-serif text-5xl md:text-6xl text-white">1943</p>
      </div>
    </div>

    {/* 2. 前面パネル */}
    <div id="intro-panel" class="absolute inset-y-0 left-0 w-full md:w-1/2 bg-white flex flex-col justify-center items-center md:items-start p-8 md:p-16 z-40 transition-transform duration-[2500ms] ease-in-out origin-left md:border-r-4 border-[#008B9B]">
      <div class="absolute top-0 left-0 w-full md:w-2 h-2 md:h-full bg-[#008B9B]"></div>
      
      <div class="relative max-w-[400px] flex flex-col items-center md:items-start">
        <p class="font-serif text-[#008B9B] text-lg tracking-[0.2em] mb-4 uppercase">Iwaki, Japan</p>
        <h1 class="font-serif text-7xl md:text-9xl text-gray-900 mb-6 tracking-tight leading-tight">nedzi</h1>
        <p class="font-serif text-gray-500 text-xl tracking-wide italic mb-10 md:mb-12 text-center md:text-left">High-Quality Hot-Forged Bolt MFG.</p>

        {/* スマホ専用キャッチコピー */}
        <div class="md:hidden flex justify-center mb-12">
          <div style="writing-mode: vertical-rl; -webkit-writing-mode: vertical-rl; text-orientation: upright; -webkit-text-orientation: upright;"
               class="text-2xl font-mincho font-bold text-gray-800 tracking-[0.3em] leading-relaxed border-r border-gray-200 pr-4">
            たかがネジ。<br />されど<span class="text-[#008B9B]">ネヂ</span>。
          </div>
        </div>

        <a href="/company" class="group relative inline-block px-8 py-4 border border-gray-800 text-gray-800 overflow-hidden transition-all duration-300 hover:bg-[#008B9B] hover:border-[#008B9B] hover:text-white">
          <span class="relative z-10 font-mb101 tracking-widest font-bold text-sm">企業情報を見る</span>
        </a>
      </div>

      {/* デスクトップ専用黄金比配置 */}
      <div class="absolute right-8 top-1/2 -translate-y-[calc(50%+44px)] hidden md:block z-10">
        <div style="writing-mode: vertical-rl; -webkit-writing-mode: vertical-rl; text-orientation: upright; -webkit-text-orientation: upright;"
             class="text-4xl font-mincho font-bold text-gray-800 tracking-[0.3em] border-r border-gray-200 pr-6">
          たかがネジ。<br />されど<span class="text-[#008B9B]">ネヂ</span>。
        </div>
      </div>
    </div>

    {/* 3. スクロールガイド（3秒後に表示） */}
    <div class="scroll-guide absolute bottom-10 left-1/2 -translate-x-1/2 z-30 flex flex-col items-center pointer-events-none">
      <span class="text-[10px] uppercase tracking-[0.4em] text-white/70 mb-2 font-serif">Scroll</span>
      <div class="w-[1px] h-12 bg-gradient-to-b from-[#008B9B] to-transparent relative overflow-hidden">
        <div class="scroll-line-inner absolute top-0 left-0 w-full h-full bg-white/40"></div>
      </div>
    </div>
    
  </section>

  {/* 強みセクション */}
  <section class="py-12 bg-gray-50">
    <div class="container mx-auto px-6">
      <div class="text-center mb-16">
        <h2 class="text-[#008B9B] font-mb101 text-3xl md:text-5xl font-bold mb-4">社会インフラを支える<br />確かな信頼</h2>
        <p class="text-gray-400 font-serif italic text-lg">Forging Trust for the Future</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">
        <div class="bg-white p-10 shadow-sm border-t-4 border-[#008B9B]">
          <h3 class="font-mb101 text-2xl font-bold mb-4 text-gray-800 transition-colors hover:text-[#008B9B]">
            <a href="/company#certification">品質保証・ISO</a>
          </h3>
          <p class="font-sans text-[14px] text-gray-600 leading-relaxed mb-6 font-medium">
            ISO9001/14001/45001の認証を取得。徹底した検査体制。
          </p>
        </div>
        <div class="bg-white p-10 shadow-sm border-t-4 border-[#008B9B]">
           <h3 class="font-mb101 text-2xl font-bold mb-4 text-gray-800 transition-colors hover:text-[#008B9B]">
             <a href="/manufacture#process">一貫製造体制</a>
           </h3>
           <p class="font-sans text-[14px] text-gray-600 leading-relaxed mb-6 font-medium">
             自社工場内での一貫した管理が、高品質・短納期を実現。
           </p>
         </div>
         <div class="bg-white p-10 shadow-sm border-t-4 border-[#008B9B]">
           <h3 class="font-mb101 text-2xl font-bold mb-4 text-gray-800 transition-colors hover:text-[#008B9B]">
             <a href="/sales#system">フルアソートメント</a>
           </h3>
           <p class="font-sans text-[14px] text-gray-600 leading-relaxed mb-6 font-medium">
             10,000種類以上の在庫。現場のニーズに即応します。
           </p>
         </div>
      </div>
    </div>
  </section>

  {/* 新着情報セクション */}
  <section class="py-12 bg-white border-t border-gray-100">
    <div class="container mx-auto px-6 max-w-6xl">
      <div class="flex items-center justify-between mb-12">
        <div>
          <h2 class="font-mb101 text-3xl md:text-4xl font-bold text-[#008B9B] mb-2">新着情報</h2>
          <p class="text-gray-500 font-serif text-base uppercase tracking-wider">Latest News</p>
        </div>
        <a href="/news" class="text-[#008B9B] font-mb101 font-bold text-sm hover:underline flex items-center gap-2 transition-colors">
          一覧へ
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      </div>
      
      <div class="bg-white border border-gray-200 rounded-sm shadow-sm overflow-hidden">
        {latestNews.length > 0 ? (
          <ul class="divide-y divide-gray-100">
            {latestNews.map((post) => (
              <li>
                <a href={`/news/${post.id}`} class="block py-6 px-6 group transition-colors hover:bg-gray-50">
                  <div class="flex flex-col md:flex-row md:items-center gap-4">
                    <div class="flex items-center gap-4 md:w-48 shrink-0">
                      <time datetime={post.date} class="text-gray-400 font-serif text-sm tracking-tighter">
                        {format(new Date(post.date), 'yyyy.MM.dd')}
                      </time>
                      {post.category && post.category.length > 0 && (
                        <span class="text-[10px] font-bold px-2 py-1 bg-[#008B9B] text-white rounded-sm uppercase tracking-widest font-mb101">
                          {post.category[0]}
                        </span>
                      )}
                    </div>
                    <h3 class="text-gray-800 font-sans text-[15px] md:text-[16px] font-bold leading-relaxed group-hover:text-[#008B9B] transition-colors flex-grow">
                      {post.title}
                    </h3>
                    <div class="hidden md:block text-gray-300 group-hover:text-[#008B9B] transform group-hover:translate-x-1 transition-all">
                      →
                    </div>
                  </div>
                </a>
              </li>
            ))}
          </ul>
        ) : (
          <div class="py-12 text-center text-gray-500 font-sans">
            お知らせはまだありません
          </div>
        )}
      </div>
    </div>
  </section>

  {/* ソーシャルメディアセクション */}
  <section class="py-12 bg-gray-50 border-t border-gray-100">
    <div class="container mx-auto px-6 max-w-6xl">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
        <div class="flex flex-col">
          <a
            href="https://www.linkedin.com/company/%E6%9D%B1%E5%8C%97%E3%83%8D%E3%83%82%E8%A3%BD%E9%80%A0%EF%BC%88%E6%A0%AA%EF%BC%89/posts/?feedView=all"
            target="_blank"
            rel="noopener noreferrer"
            class="bg-[#008B9B] text-white px-6 py-3 rounded-t-sm shadow-sm flex justify-between items-center"
          >
            <span class="font-['Barlow_Condensed'] text-xl font-bold text-white">Our LinkedIn Site</span>
            <span class="text-xs opacity-80 text-white">View latest updates →</span>
          </a>
          <div class="bg-white border-x border-b border-gray-200 shadow-sm rounded-b-sm overflow-hidden p-1 h-[600px] overflow-y-auto custom-scrollbar">
            <iframe
              src={LINKEDIN_EMBED_URL}
              height={LINKEDIN_IFRAME_HEIGHT}
              width="100%"
              frameborder="0"
              allowfullscreen
              title="LinkedIn Post"
              class="w-full"
            ></iframe>
          </div>
        </div>
        <div class="hidden md:block"></div>
      </div>
    </div>
  </section>

</Layout>

<style>
  /* 扉の移動アニメーション */
  :global(.is-animated) #intro-panel {
    transform: translateX(-100%);
  }

  /* スクロールガイドの初期状態とフェードイン */
  .scroll-guide {
    opacity: 0;
    transition: opacity 1.5s ease-out;
  }

  :global(.is-animated) .scroll-guide {
    opacity: 1;
  }

  /* 線が流れるアニメーション */
  .scroll-line-inner {
    transform: translateY(-100%);
    animation: scrollLine 2s infinite ease-in-out;
    /* 3秒の静寂後、扉が開くタイミングでアニメーション開始 */
    animation-delay: 3s; 
  }

  @keyframes scrollLine {
    0% { transform: translateY(-100%); }
    50% { transform: translateY(100%); }
    100% { transform: translateY(100%); }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      const heroSection = document.getElementById('hero-section');
      if (heroSection) {
        heroSection.classList.add('is-animated');
      }
    }, 3000);
  });
</script>