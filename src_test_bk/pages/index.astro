---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import { getNews } from '../lib/microcms';
import { format } from 'date-fns';

// 最新5件のお知らせを取得
const response = await getNews({ 
  fields: ["id", "title", "date", "category", "thumbnail"],  // ← date, thumbnail
  limit: 5,
  orders: '-date'  // 日付の降順（新しい順）
});
const latestNews = response.contents;
---

<Layout title="Top">
  
  <section class="relative w-full h-auto md:h-screen min-h-screen flex flex-col md:flex-row overflow-hidden bg-white">
    
    {/* 左側：ブランドエリア */}
    {/* スマホ時の高さを min-h-[85vh] に拡大し、ヘッダー回避の pt-28 を設定 */}
    <div class="w-full md:w-1/2 min-h-[85vh] md:h-full bg-white flex flex-col justify-center items-center md:items-start pt-28 pb-16 px-8 md:p-16 z-10 relative md:border-r-4 border-[#008B9B]">
      <div class="absolute top-0 left-0 w-full md:w-2 h-2 md:h-full bg-[#008B9B]"></div>
      
      {/* ロゴ・ボタンのコンテナ */}
      <div class="relative max-w-[400px] flex flex-col items-center md:items-start">
        <p class="font-serif text-[#008B9B] text-lg tracking-[0.2em] mb-4 uppercase">
          Iwaki, Japan
        </p>
        
        {/* 文字切れを防ぐため leading-tight を適用 */}
        <h1 class="font-serif text-7xl md:text-9xl text-gray-900 mb-6 tracking-tight leading-tight">
          nedzi
        </h1>
        
        <p class="font-serif text-gray-500 text-xl tracking-wide italic mb-10 md:mb-12 text-center md:text-left">
          High-Quality Hot-Forged Bolt MFG.
        </p>

        {/* 【復活】スマホ専用:縦組み2行キャッチコピー（余白を mb-12 に調整） */}
        <div class="md:hidden flex justify-center mb-12">
           <div 
            style="writing-mode: vertical-rl; -webkit-writing-mode: vertical-rl; text-orientation: upright; -webkit-text-orientation: upright;"
            class="text-2xl font-mincho font-bold text-gray-800 tracking-[0.3em] leading-relaxed border-r border-gray-200 pr-4"
           >
            たかがネジ。<br />されど<span class="text-[#008B9B]">ネヂ</span>。
          </div>
        </div>

        <a href="/company" class="group relative inline-block px-8 py-4 border border-gray-800 text-gray-800 overflow-hidden transition-all duration-300 hover:bg-[#008B9B] hover:border-[#008B9B] hover:text-white">
          <span class="relative z-10 font-mb101 tracking-widest font-bold text-sm">企業情報を見る</span>
        </a>
      </div>

      {/* 【デスクトップ専用:黄金比配置】（変更なし） */}
      <div class="absolute right-8 top-1/2 -translate-y-[calc(50%+44px)] hidden md:block z-10">
         <div 
          style="writing-mode: vertical-rl; -webkit-writing-mode: vertical-rl; text-orientation: upright; -webkit-text-orientation: upright;"
          class="text-4xl font-mincho font-bold text-gray-800 tracking-[0.3em] border-r border-gray-200 pr-6"
         >
          たかがネジ。<br />されど<span class="text-[#008B9B]">ネヂ</span>。
        </div>
      </div>
    </div>

    {/* 右側：メインビジュアルエリア（スマホ時の高さも確保） */}
    <div class="w-full md:w-1/2 h-[50vh] md:h-full relative bg-gray-900">
      <img src={`${import.meta.env.BASE_URL}/images/main-visual.webp`} alt="熱間鍛造の現場" class="absolute inset-0 w-full h-full object-cover object-center" />
      <div class="absolute inset-0 bg-gradient-to-tr from-[#E64A19] to-gray-900 opacity-10 mix-blend-multiply"></div>
      <div class="absolute bottom-10 right-10 text-white text-right z-20">
        <p class="text-[10px] md:text-sm tracking-widest mb-1 md:mb-2 opacity-80 uppercase">Established in</p>
        <p class="font-serif text-4xl md:text-6xl">1943</p>
      </div>
    </div>
  </section>

  {/* 下部ブロック（強みセクション） */}
  <section class="py-24 bg-gray-50">
    <div class="container mx-auto px-6">
      <div class="text-center mb-16">
        <h2 class="text-[#008B9B] font-mb101 text-3xl md:text-5xl font-bold mb-4">社会インフラを支える<br />確かな信頼</h2>
        <p class="text-gray-400 font-serif italic text-lg">Forging Trust for the Future</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">
        <div class="bg-white p-10 shadow-sm border-t-4 border-[#008B9B]">
          <h3 class="font-mb101 text-2xl font-bold mb-4 text-gray-800">品質保証・ISO</h3>
          <p class="font-sans text-[14px] text-gray-600 leading-relaxed mb-6 font-medium">
            ISO9001/14001/45001の認証を取得。徹底した検査体制で、不具合も許しません。
          </p>
        </div>
        <div class="bg-white p-10 shadow-sm border-t-4 border-[#008B9B]">
           <h3 class="font-mb101 text-2xl font-bold mb-4 text-gray-800">一貫製造体制</h3>
           <p class="font-sans text-[14px] text-gray-600 leading-relaxed mb-6 font-medium">
             自社工場内での一貫した管理が、高品質・短納期を実現します。
           </p>
         </div>
         <div class="bg-white p-10 shadow-sm border-t-4 border-[#008B9B]">
           <h3 class="font-mb101 text-2xl font-bold mb-4 text-gray-800">フルアソートメント</h3>
           <p class="font-sans text-[14px] text-gray-600 leading-relaxed mb-6 font-medium">
             10,000種類以上の在庫。現場のニーズに即応します。
           </p>
         </div>
      </div>
    </div>
  </section>

  {/* 新着情報セクション */}
  <section class="py-20 bg-white border-t border-gray-100">
    <div class="container mx-auto px-6 max-w-6xl">
      
      {/* セクションヘッダー */}
      <div class="flex items-center justify-between mb-12">
        <div>
          <h2 class="font-mb101 text-3xl md:text-4xl font-bold text-[#008B9B] mb-2">新着情報</h2>
          <p class="text-gray-500 font-serif text-base uppercase tracking-wider">Latest News</p>
        </div>
        <a 
          href="/news" 
          class="text-[#008B9B] font-mb101 font-bold text-sm hover:underline flex items-center gap-2 transition-colors"
        >
          一覧へ
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      </div>
      
      {/* お知らせ一覧 */}
      <div class="bg-white border border-gray-200 rounded-sm shadow-sm overflow-hidden">
        {latestNews.length > 0 ? (
          <ul class="divide-y divide-gray-100">
            {latestNews.map((post) => (
              <li>
                <a href={`/news/${post.id}`} class="block py-6 px-6 group transition-colors hover:bg-gray-50">
                  <div class="flex flex-col md:flex-row md:items-center gap-4">
                    {/* 日付とカテゴリ */}
                    <div class="flex items-center gap-4 md:w-48 shrink-0">
                      <time datetime={post.publishedAt} class="text-gray-400 font-serif text-sm tracking-tighter">
                        {format(new Date(post.date), 'yyyy.MM.dd')}
                      </time>
                      
                      {post.category && post.category.length > 0 && (
                        <span class="text-[10px] font-bold px-2 py-1 bg-[#008B9B] text-white rounded-sm uppercase tracking-widest font-mb101">
                          {post.category[0]}
                        </span>
                      )}
                    </div>
                    
                    {/* タイトル */}
                    <h3 class="text-gray-800 font-sans text-[15px] md:text-[16px] font-bold leading-relaxed group-hover:text-[#008B9B] transition-colors flex-grow">
                      {post.title}
                    </h3>

                    {/* 矢印アイコン */}
                    <div class="hidden md:block text-gray-300 group-hover:text-[#008B9B] transform group-hover:translate-x-1 transition-all">
                      →
                    </div>
                  </div>
                </a>
              </li>
            ))}
          </ul>
        ) : (
          <div class="py-12 text-center text-gray-500 font-sans">
            お知らせはまだありません
          </div>
        )}
      </div>　
    </div>
  </section>
</Layout>
